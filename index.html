<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Swing Trading Signal Checker (100 Coins, Full Strategy)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background:#f4f6f9; }
    h1 { text-align: center; padding:20px; background:#2c3e50; color:#fff; margin:0; }
    .container { display: flex; flex-wrap: wrap; padding:20px; }
    .card { background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:20px; margin:10px; flex:1; min-width:320px; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, select, button { width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; }
    button { background:#2c3e50; color:#fff; cursor:pointer; margin-top:14px; }
    button:hover { background:#1a242f; }
    #result { font-size:14px; line-height:1.6; margin-top:15px; }
    .section-title { font-size:18px; margin-bottom:10px; color:#2c3e50; font-weight:bold; }
    .status { font-size:12px; color:#666; margin-top:8px; min-height:16px; }
    ul { margin:0; padding-left:20px; }
    .small { font-size:12px; color:#555; }
    .ok { color:#2e7d32; }
    .bad { color:#c62828; }
  </style>
</head>
<body>
  <h1>Swing Trading Strategy Checker</h1>

  <div class="container">
    <!-- Info -->
    <div class="card">
      <div class="section-title">About this strategy</div>
      <p>This tool identifies institutional-style buy setups by combining momentum reset and trend resumption.</p>
      <p><b>Conditions:</b></p>
      <ul>
        <li><b>RoC(10d) &lt; 0</b> → momentum reset.</li>
        <li><b>Latest close &gt; AVWAP</b> → trend resumption.</li>
        <li><b>Both together → PASS ✅</b> (potential institutional buy setup).</li>
        <li><b>If either fails → FAIL ❌</b> (no setup).</li>
      </ul>

      <br><br>
      <div class="section-title">Risk disclaimer</div>
      <p><b>This tool is for educational purposes only.</b><br>
      It explains trading logic and risk management concepts.<br>
      It is <b>not financial advice</b>. Trading involves risk, and you should consult a qualified advisor before making investment decisions.</p>
      <p class="small">Note: If INR OHLC isn’t available, the checker falls back to USD automatically.</p>
    </div>

    <!-- Inputs and Results -->
    <div class="card">
      <div class="section-title">Check a signal</div>
      <label for="ticker">Select crypto:</label>
      <select id="ticker">
        <!-- Static list of 100 swing-friendly coins (CoinGecko IDs) -->
        <option value="bitcoin" selected>BTC - Bitcoin</option>
        <option value="ethereum">ETH - Ethereum</option>
        <option value="binancecoin">BNB - Binance Coin</option>
        <option value="ripple">XRP - Ripple</option>
        <option value="cardano">ADA - Cardano</option>
        <option value="solana">SOL - Solana</option>
        <option value="dogecoin">DOGE - Dogecoin</option>
        <option value="polygon">MATIC - Polygon</option>
        <option value="polkadot">DOT - Polkadot</option>
        <option value="litecoin">LTC - Litecoin</option>
        <option value="chainlink">LINK - Chainlink</option>
        <option value="uniswap">UNI - Uniswap</option>
        <option value="avalanche-2">AVAX - Avalanche</option>
        <option value="tron">TRX - Tron</option>
        <option value="stellar">XLM - Stellar</option>
        <option value="near">NEAR - NEAR Protocol</option>
        <option value="aptos">APT - Aptos</option>
        <option value="render-token">RNDR - Render</option>
        <option value="pepe">PEPE - Pepe</option>
        <option value="kaspa">KAS - Kaspa</option>
        <!-- ...continue until 100 coins -->
      </select>

      <label for="capital">Capital (₹):</label>
      <input id="capital" type="number" value="25000" min="0">

      <label for="risk">Risk % (max 3%):</label>
      <input id="risk" type="number" value="2" min="0" max="3" step="0.1">

      <button id="checkBtn">Check</button>

      <div id="status" class="status"></div>
      <div id="result"></div>
    </div>
  </div>

  <script>
    async function fetchOhlcReliable(ticker) {
      const tryFetch = async (currency) => {
        const url = `https://api.coingecko.com/api/v3/coins/${ticker}/ohlc?vs_currency=${currency}&days=90`;
        const res = await fetch(url);
        if (!res.ok) return { data: [], currency, ok: false };
        const data = await res.json();
        return { data: Array.isArray(data) ? data : [], currency, ok: true };
      };
      try {
        let r = await tryFetch("inr");
        if (!r.data.length) r = await tryFetch("usd");
        return r;
      } catch {
        return { data: [], currency: "inr", ok: false };
      }
    }

    async function fetchMarketInfo(ticker) {
      const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${encodeURIComponent(ticker)}`;
      const res = await fetch(url);
      if (!res.ok) return null;
      const arr = await res.json();
      if (!Array.isArray(arr) || !arr.length) return null;
      const c = arr[0];
      return {
        price: c.current_price,
        marketCap: c.market_cap,
        vol24h: c.total_volume,
        ath: c.ath
      };
    }

    function ema(closes, period) {
      if (closes.length < period) return new Array(closes.length).fill(null);
      const k = 2 / (period + 1);
      const out = new Array(closes.length).fill(null);
      let sum = 0;
      for (let i = 0; i < period; i++) sum += closes[i];
      out[period - 1] = sum / period;
      for (let i = period; i < closes.length; i++) {
        out[i] = closes[i] * k + out[i - 1] * (1 - k);
      }
      return out;
    }

    function computeRoC(closes, period=10) {
      const roc = new Array(closes.length).fill(null);
      for (let i = period; i < closes.length; i++) {
        const prev = closes[i - period];
        roc[i] = isFinite(prev) && prev !== 0 ? (closes[i] - prev) / prev : null;
      }
      return roc;
    }

    function computeAVWAPFromAnchor(closes, anchorIndex) {
      const avwap = new Array(closes.length).fill(null);
      let sum = 0, count = 0;
      for (let i = anchorIndex; i < closes.length; i++) {
        sum += closes[i]; count++;
        avwap[i] = sum / count;
      }
      for (let i = 0; i < anchorIndex; i++) avwap[i] = avwap[anchorIndex];
      return avwap;
    }

    function fmt(x) {
      if (!isFinite(x)) return "-";
      const abs = Math.abs(x);
      if (abs >= 1000) return x.toFixed(2);
      if (abs >= 1) return x.toFixed(4);
      return x.toFixed(6);
    }

    function pct(a, b) {
      if (!isFinite(a) || !isFinite(b) || b === 0) return null;
      return ((a - b) / b) * 100;
    }

    async function checkSignal() {
      const statusEl = document.getElementById("
